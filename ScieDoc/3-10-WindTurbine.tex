%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CONTRIBUTION TO THE MESONH BOOK1: "Wind turbine parameterization"
% Authors : Joulin Pierre-Antoine
% Original : February 15, 2021
% Update
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Wind turbine parameterizations}
\minitoc

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Several wind turbine parameterizations have been introduced in Meso-NH with the aim of studying the interactions between wind farms and local meteorology. The wind turbines are taken into account using actuator methods (or body forces). For more details about the wind turbines parameterizations introduced in Meso-NH, see \citet{joulin2019modelisation}. For a general review of wind turbines and wind farm flows, see \citet{porte2020wind}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Non-Rotating Actuator Disk (ADNR)}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%++++++++++++++++++++++++++++++++
\subsection{Overview}
%++++++++++++++++++++++++++++++++
The \textit{Non-Rotating Actuator Disk} (ADNR) is a pioneer theory proposed by \citet{rankine1865mechanical} and \citet{froude1889part}. It allows to obtain interesting results about propellers. Nowadays, it has been generalized for wind turbine study.
\medbreak
The ADNR consists in applying a thrust force over the disk drawn by the blades. This aerodynamic force acts against the wind to disturb the flow. The evaluation of the thrust force is based on a 1D momentum theory : only an axial force is considered. The Non-Rotating Actuator Disk model can be seen as a simplified Actuator Disk with Rotation, which has been initially coupled by \citet{sorensen1992unsteady} to a CFD code.
\medbreak
The first simulations coupled to a LES have been done by \citet{jimenez2007advances}, \citet{jimenez2008large}, and \citet{wu2011large}. It has been used to study wind farms as showed by \citet{wu2015modeling} or \citet{shamsoddin2017large}, or impact on local meteorology such as in \citet{calaf2010large} or \citet{calaf2011large}.

%++++++++++++++++++++++++++++++++
\subsection{Theory}
%++++++++++++++++++++++++++++++++
\subsubsection*{Hypotheses}
\label{sss:ADNRhyp}
The flow is assumed to be stationary and irrotational, and the fluid incompressible. Besides, as the wind turbine is simplified to a porous disk drawn by the blades, it is assumed that the wind turbine has an infinite number of blades, that the thrust is uniformly distributed over the disk, and that the wake rotation can be neglected. See \citep{joulin2019modelisation} for discussions.

	
		\subsubsection*{Stream-tube}
				\label{sss:ADTubeC}

By extracting the kinetic energy from the wind, the wind turbine produces a velocity deficit downstream, generating the so-called ``wake''. It is possible to consider a stream-tube around the rotor disk of the wind turbine, as illustrated in Fig. \ref{fig:BEMTube3D}. As the fluid is considered incompressible, the mass flow rate is conserved. Then, the cross-sectional area of the stream-tube must expand downstream to balance the velocity deficit.
				
\begin{figure}[h]
\centering
\includegraphics[scale=0.5]{\EPSDIR/Wind_Turbine_fig/Tube.pdf}
\caption{Stream-tube around the rotor disk of a wind turbine. \citet{joulin2019modelisation} adapted from \citet{burton2001wind}}  
\label{fig:BEMTube3D}
\end{figure}		
		
\medbreak
A vertical cut of the stream-tube is given in Figure \ref{fig:BEMTubeEq}. One can write $U$ the axial velocity, $p$ the pressure and $A$ the cross-sectional area. The indices $_\infty$, $_d$ and $_W$ indicate respectively the upstream, disk and downstream positions. The exponents $^+$ and $^-$ indicate the infinitesimal upstream and downstream sides of the disc. The thrust force $F_T$ writes:
\begin{equation}
\label{eq:FpDef}
F_T = A_d (p_d^+ - p_d^-).
\end{equation}		
\medbreak
\begin{figure}[h]
\centering
\includegraphics[scale=0.5]{\EPSDIR/Wind_Turbine_fig/Tube_Eq.pdf}
\caption{Vertical cut of the stream-tube around the rotor disk of a wind turbine and its variables. \citet{joulin2019modelisation} adapted from \citet{burton2001wind}}  
\label{fig:BEMTubeEq}
\end{figure}
\medbreak
	
It is possible to apply the Bernoulliâ€™s theorem to the upstream part, and to the downstream one, separately. It gives: 
\begin{equation}
\label{eq:Bern}
\left\lbrace
\begin{array}{ccc}		
p_\infty + \dfrac{1}{2} \rho U_\infty^2 = p_d^+ + \dfrac{1}{2} \rho U_d^2
\\
p_d^- + \dfrac{1}{2} \rho U_d^2 = p_\infty+ + \dfrac{1}{2} \rho U_W^2,
\\
\end{array}\right.
\end{equation}
where $\rho$ is the air density. Using (\ref{eq:Bern}) in (\ref{eq:FpDef}), the thrust force becomes:
\begin{equation}
\fbox{$
F_T = \dfrac{1}{2} \rho A_d (U_\infty^2 -  U_W^2)
$}.
\label{eq:FpBern}
\end{equation}		

This first expression gives the thrust force by knowing the upstream velocity: $F_T = f(U_\infty)$. In practice, it is impossible to define a proper $U_\infty$. Then, an expression with the velocity at the disk position: $F_T = f(U_d)$ has to be found. It is the aim of the next paragraphs.



		\subsubsection*{Momentum theory}
				\label{p:ADNRAppliTheo}
The axial induction factor $a$ describes the percentage of velocity deficit:
\begin{equation}
U_d = U_\infty( 1 - a ).
\label{eq:a}
\end{equation}
By applying the moment theory, the thrust force $F_T$ can be expressed at the position of the disc (see \citet{joulin2019modelisation} for more details) as:
\begin{equation}	
\label{eq:FpD}	
\fbox{$
F_T = \dfrac{1}{2} \rho A_d U_d^2 \dfrac{4a}{1-a}.
$}			
\end{equation}

The thrust coefficient $C_{T_\infty}$ is the rate between the thrust force and the dynamic force of the wind. One can note that it is defined with the upstream velocity $U_\infty$. It can be expressed using the axial induction factor $a$:
\begin{equation}	
\label{eq:ct}	
C_{T_\infty} = \dfrac{F_T}{\dfrac{1}{2} \rho A_d U_\infty^2} = 4 a (1 -a).
\end{equation}	

		\subsubsection*{Final expression of thrust force}

The thrust coefficient $C_{T_\infty}$  is a well-known data (tabulated data $C_{T_\infty} = f(U_{\infty})$ given by the constructor). Then, by using  (\ref{eq:ct}), one can write $a$ as:
\begin{equation}
a = \dfrac{1}{2}(1-\sqrt{1-C_{T_\infty}}).
\end{equation}
Then, one can define $C_{T_d}$:
\begin{equation}	
C_{T_d} = \dfrac{4a}{1 -a},
\end{equation}	
to finally obtain a suitable expression for the thrust coefficient, using $U_d$ only:
\begin{equation}
\fbox{$
F_T = \dfrac{1}{2} \rho A_d U_d^2 C_{T_d}
$}.
\label{eq:finadnr}
\end{equation}  

%++++++++++++++++++++++++++++++++
\subsection{Numerical implementation}
%++++++++++++++++++++++++++++++++

In Meso-NH, the ADNR is discretised according to the mesh, as illustrated in Fig. \ref{fig:adnum}.
\begin{figure}[h]
\centering
\includegraphics[scale=0.5]{\EPSDIR/Wind_Turbine_fig/ADnum.pdf}
\caption{Discretization of the ADNR \citet{joulin2019modelisation}.}
\label{fig:adnum}  
\end{figure}
\medbreak
The first step of the coupling algorithm is to find the cells where the infinitesimal thrust forces will be applied. It is done by checking if the cell is located into the rotor disk. Then, the wind speed of the cell $U_d$ is extracted, after it has been evaluated at mass point (C-type of Arakawa). It is possible to use the closest value of the wind, or to interpolate it from the 8-neighborhood cells. Finally, the discrete thrust force is calculated by using (\ref{eq:finadnr}) as follows:
\begin{equation}
\fbox{$
dF_T = \dfrac{1}{2} \rho \Delta y \Delta z U_d^2 C_{T_d}
$},
\label{eq:adnrft}
\end{equation}
where $\Delta y \Delta z$ is the vertical area of the cell. This force will act against the wind field, as shown in Figure \ref{fig:appluforceadnr}. This is why, in the end, the force $dF_{T_{WT\rightarrow WIND}} = -dF_T$ is added to the global momentum budget of Meso-NH. 
\begin{figure}[h]
\centering
\includegraphics[scale=0.6]{\EPSDIR/Wind_Turbine_fig/ApplyForceADNR.pdf}
\caption{Applying discrete thrust forces in Meso-NH \citet{joulin2019modelisation}.}
\label{fig:appluforceadnr}  
\end{figure}

%++++++++++++++++++++++++++++++++
\subsection{Additional implementations}
%++++++++++++++++++++++++++++++++		
\subsubsection*{1D Linear smearing}
\label{sss:1dsmearADNR}
To avoid numerical instabilities, it is possible to apply a linear smearing to the force field. It is done by using the C-type cells of Arakawa. To smear the forces linearly, one can apply successively:
\begin{equation}
dF_{x_{i}^m} = \dfrac{dF_{x_{i}^f} + dF_{x_{i+1}^f}}{2},
\end{equation}
and then,
\begin{equation}
dF_{x_{i}^f} = \dfrac{dF_{x_{i}^m} + dF_{x_{i+1}^m}}{2},
\end{equation}
where $x_i^m$ and $x_i^f$ are respectively  the mass point and the flux point of the $i^{th}$ cell of $x$-axis. An illustration is given in Figure \ref{fig:smearinglin}. This method is less expensive numerically than the usual convolution product, and seems to provide similar results. See \citet{joulin2019modelisation} for discussions.

\begin{figure}[h]
\centering
\includegraphics[scale=1]{\EPSDIR/Wind_Turbine_fig/Smearing_Linear.pdf}
\caption{Scheme of an 1D linear smearing of the force field \citet{joulin2019modelisation}.}
\label{fig:smearinglin}  
\end{figure}

\subsubsection*{3D linear smearing}
\label{sss:3dsmearADNR}
It is possible to use a 3D linear smearing based on the 1D Linear distribution, by applying the same method on $y$-axis and $z$-axis successively.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Rotating Actuator Disk (ADR)}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%++++++++++++++++++++++++++++++++
\subsection{Overview}
%++++++++++++++++++++++++++++++++
In the Actuator Disk model developed by \citet{rankine1865mechanical} and \citet{froude1889part}, rotor rotation and tangential forces are neglected. The Rotating Actuator Disk (ADR) model addresses these effects by incorporating the Blade Element (BE) theory developed by \citet{glauert1935airplane}. This theory involves dividing the blade into multiple sections and studying the flow over each section (Figure \ref{fig:Decoupage2D}). It is used to assess the forces acting on a blade based on the lift and drag forces generated at each section of the blade.

\begin{figure}[h]
\centering
\includegraphics[scale=0.4]{\EPSDIR/Wind_Turbine_fig/Decoupage2D.pdf}
\caption{Schematic representation of Blade Element theory \citet{joulin2019modelisation}.}
\label{fig:Decoupage2D}
\end{figure}
\medbreak
Based on the principle of `body forces', the ADR method does not explicitly represent the geometry of the blades. Once again, the rotor effect is considered through equivalent volume forces. With the ADR, not only is the thrust force of the turbine on the wind modeled, but also the rotor torque, which is not considered in the ADNR model. The concept involves considering an average effect of the blades on the surface they sweep during their rotations. In this methodology, the ADR is discretized in a cylindrical coordinate system, with a certain number of azimuthal elements (segmented by $\Delta \theta$) and radial elements (segmented by $dr$), as shown in Figure \ref{fig:ADR_mesh}. At each time step and at a specific radial location $r$, each azimuthal position carries the effects of the blades, weighted by the ratio of the surface element to the total annular surface at the given $r$.

\begin{figure}[h]
\centering
\includegraphics[scale=0.8]{\EPSDIR/Wind_Turbine_fig/ADR_mesh.pdf}
\caption{Overview of ADR mesh \citet{joulin2019modelisation}.}
\label{fig:ADR_mesh}
\end{figure}
\medbreak

To enhance the representation of wind wakes, \citet{sorensen1992unsteady} introduced the rotation of the Actuator Disk model in their CFD code. Their work demonstrates that this addition provides fundamental insights into wake characteristics (\citet{sorensen1995model, sorensen1998analysis}). Subsequent studies by \citet{madsen1997cfd} and \citet{mikkelsen2003actuator} focused on wind turbines with pre-cones or misalignment to the wind direction.

Later on, the ADR wind turbine model was coupled with Large Eddy Simulation (LES) by the EPFL team (\citet{porte2011large, wu2011large, wu2015modeling, porte2014interaction}). This coupling enables a simple yet effective representation of the wind turbine while leveraging the detailed turbulence representation provided by LES. This approach allowed the study of wake evolution and its impacts on the atmospheric boundary layer.

Subsequently, ADR was coupled with WRF LES, a U.S. atmospheric code, to initiate the study of real wind farms (\citet{aitken2014utility, aitken2014large, mirocha2014implementation, mirocha2015investigating, marjanovic2015simulation}). These studies aimed to analyze wind farm layout and wake evolution, with the ultimate goal of optimizing wind resource exploitation, potentially through control and command strategies.


%++++++++++++++++++++++++++++++++
\subsection{Theory}
%++++++++++++++++++++++++++++++++
\subsubsection*{Hypotheses}
\label{ss:hypADR}
The model is based on a number of assumptions:
\begin{itemize}
\item Incompressible flow,
\item 2D flow along the airfoils,
\item No aerodynamic interaction between each blade element (which excludes any radial flow),
\item As the wind turbine is simplified to a porous disk, an infinite number of blades is considered.
\end{itemize}

\subsubsection*{Wind turbine kinematics and frames}		
\label{ss:EOL_M_cinematiqueADR}
The wind turbine can be divided into different kinematic classes. As shown in Figure \ref{fig:ADR_frames}, each class has its own frame:
\begin{multicols}{2}
\begin{itemize}
\item the domain associated with $R_G$ frame,
\item the tower associated with $R_T$ frame,
\item the nacelle associated with $R_N$ frame,
\item the hub associated with $R_H$ frame.
\end{itemize}
\end{multicols}
In this implementation, the rotation of the wind turbine is taken into account by applying the rotational movement of the hub frame around the nacelle frame. To ease computations, 2 other frames have been created:
\begin{itemize}
\item the cylindrical frame $R_{C}$, linked to the hub frame,
\item frames attached to discretized annular elements: the $j^{th}$ radial elements of the $i^{th}$ azimutal element $R_{E_{ij}}$ frames.
\end{itemize}
\medbreak
The rotation matrices $\mathcal{M}_{R_\clubsuit \rightarrow R_\spadesuit}$ are determined at each time step to move from a frame to another one. The kinematic relations allow to know the translational and rotational velocities of each blade element. Details about these relations can be found in \citet{joulin2019modelisation}, \textit{Annexe C} (applied to Actuator Line).
\medbreak

\begin{figure}
    \centering
    \begin{minipage}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{\EPSDIR/Wind_Turbine_fig/RepereADR_Gen.jpg}
        %\subcaption{}
        \label{fig:a}
    \end{minipage}
    \hfill
    \begin{minipage}{0.32\textwidth}
        \centering
        \includegraphics[width=0.8\textwidth]{\EPSDIR/Wind_Turbine_fig/RepereADR_Cyl.jpg}
        %\subcaption{}
        \label{fig:b}
    \end{minipage}
    \hfill
    \begin{minipage}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{\EPSDIR/Wind_Turbine_fig/RepereADR_Elmt.png}
        %\subcaption{}
        \label{fig:c}
    \end{minipage}
    \caption{Illustration of ADR's frames. Left: global, tower, nacelle, and hub frames. Middle: cylindrical frame. Right: element frame.}
    \label{fig:ADR_frames}
\end{figure}

\subsubsection*{Applying blade element theory}

\paragraph*{Determination of $U_{rel}$ and $\alpha$:}
Thanks to the kinematic definition and to the rotation matrices, the determination of the relative wind $U_{rel}$ is almost direct. Indeed, the kinematic relations enable to know the velocity of translation $U^{ij}_{trans}$. Considering the $j^{th}$ elements of the $i^{th}$ blade located in a surrounding volume of air with a velocity $U^{ij}_{wind}$, the relative velocity writes:
\begin{equation}
\label{eq:ADR_urel}
\fbox{$
\overrightarrow{U^{ij}_{rel}}_{\vert _{R_{E_{ij}}}} = \mathcal{M}_{R_{E_{ij}} \rightarrow R_{G_{ij}}} \times \overrightarrow{U^{ij}_{wind}}_{\vert _{R_{G_{ij}}}} - \overrightarrow{U^{ij}_{trans}}_{\vert _{R_{E_{ij}}}}
$}.
\end{equation}
And the angle of attack $\alpha$ can be evaluated thanks to:
\begin{equation}
\label{eq:ADR_alpha}
\fbox{$
\alpha = tan^{-1} \left( \dfrac{\overrightarrow{U^{ij}_{rel}}_{\vert _{R_{E_{ij}}}} \cdot \overrightarrow{x}}{\overrightarrow{U^{ij}_{rel}}_{\vert _{R_{E_{ij}}}} \cdot \overrightarrow{y}} \right)
$}.
\end{equation}

\paragraph*{Aerodynamic forces:}
By knowing $U_{rel}$ and $\alpha$, the blade element theory can be applied. The aerodynamic forces can be expressed in the aerodynamic frame as:
\begin{equation}
\label{eq:eol_m_adr_eff}	
\left\lbrace
\begin{array}{ccc}	
dF_{L} = \dfrac{1}{2} \rho S U_{rel}^2 C_L(\alpha),
\\   
\\
dF_{D} = \dfrac{1}{2} \rho S U_{rel}^2 C_D(\alpha).
\\
\end{array}\right.
\end{equation}	

where the lift $C_L$ and drag $C_D$ coefficients are known according to the angle of attack $\alpha$ and the Reynolds number $Re$. The lifting surface $S$, evaluated with the airfoil chord $c$ and the radial width $dr$ ($S = c dr$).
\medbreak
This elementary force represents the force from a section of one blade (not from an annular element). Applying this force throughout the infinite number of blades would be incorrect. To ensure momentum conservation, the loads need to be distributed evenly over the discretized disc. This is achieved using the ratio between the number of blades $N_{\text{blades}}$ and the number of azimuthal elements $2\pi/\Delta\theta$. Introducing a new surface $S'$ defined as:
\begin{equation}
S' = S N_{blades} \dfrac{\Delta\theta}{2\pi},
\end{equation}
One can obtain:
\begin{equation}
\label{eq:eol_m_adr_final}        
\fbox{$
\left\lbrace
\begin{array}{ccc}      
df_{L} = \dfrac{1}{2} \rho S' U_{rel}^2 C_L,
\\   
\\
df_{D} = \dfrac{1}{2} \rho S' U_{rel}^2 C_D.
\\
\end{array}\right.
$}
\end{equation}
By applying a rotation angle $a$, the forces can be expressed in $R_{E_{ij}}$, and then in the global frame by using $\mathcal{M}_{R_{G_{ij}} \rightarrow R_{E_{ij}}}$.


%++++++++++++++++++++++++++++++++
\subsection{Numerical implementation}
%++++++++++++++++++++++++++++++++

The first step of the Rotating Actuator Disc is to compute the kinematics of the wind turbine. The kinematic algorithm computes, at each time step, the new positions and velocities of all elements. 
Knowing the position of an annular blade element, the local wind speed can be extracted. To do so, the wind speed is computed at mass point. Then, it is possible to use the closest value (from the blade element) of the wind, or to interpolate it from the 8-neighborhood cells.
Afterwards, the relative velocity is computed using (\ref{eq:ADR_urel}), and the angle of attack $\alpha$ with (\ref{eq:ADR_alpha}). The aerodynamic coefficients $C_L$ and $C_D$ are then computed by knowing $\alpha$, from a spline-cubic interpolation of the tabulated input data. Finally, the aerodynamic forces are computed in the aerodynamic frame using (\ref{eq:eol_m_adr_final}): 
\begin{equation}
\label{eq:eol_m_alm_eff_num}	
\fbox{$
\left\lbrace
\begin{array}{ccc}	
df_{L} = \dfrac{1}{2} \rho S' U_{rel}^2 C_L(\alpha),
\\   
\\
df_{D} = \dfrac{1}{2} \rho S' U_{rel}^2 C_D(\alpha).
\\
\end{array}\right.
$}
\end{equation}	
A last change of frame enables the projection of these forces to the global momentum budget of Meso-NH. One can note that, for the moment, only the effects of the blades are computed: the nacelle and the tower are neglected. 

Note: Special attention must be given to the number of radial (NNB\_RADELT) and azimuthal (NNB\_AZIELT) elements depending on the mesh used in Meso-NH. To avoid gaps in the mesh and ensure a proper distribution of efforts, it is recommended to have:
\begin{equation}
NNB\_RADELT > \dfrac{2R}{\min(\Delta x, \Delta y, \Delta z)}
\end{equation}
and
\begin{equation}
NNB\_AZIELT > \pi / \sin^{-1} \left( \dfrac{\min(\Delta x, \Delta y, \Delta z)}{2R} \right)
\end{equation}
where $R$ is the radius of the rotor, and $\min(\Delta x, \Delta y, \Delta z)$ is the smallest dimension of the Meso-NH mesh at the rotor level.

%++++++++++++++++++++++++++++++++
\subsection{Additional implementations}
%++++++++++++++++++++++++++++++++
\subsubsection*{1D linear smearing}
It is possible to use the 1D linear smearing mentionned in \ref{sss:1dsmearADNR}.

\subsubsection*{3D linear smearing}
It is possible to use the 3D linear smearing mentionned in \ref{sss:3dsmearADNR}.

\subsubsection*{Tip loss correction}
\label{sss:tiplossADR}
As an infinite number of blades is considered in this Actuator method, the induction of each blade is not well reproduced, and the tip vortices are not properly modeled. To overcome this issue, \citet{glauert1935airplane} developed the so-called tip loss correction. It introduces a factor $F$ to take into account the wake-induced losses:
\begin{equation}
F = \dfrac{2}{\pi} \arccos( e^{-f})
\end{equation}
where $f$ can be expressed using the radius of the tip $r_{tip}$ and the flow angle $\varphi$:
\begin{equation}
f=
\dfrac{N_{pales}}{2} \dfrac{r_{tip}-r}{r sin(\varphi)}
\end{equation}
Then, the factor is introduced as follows:
\begin{equation}	
\label{eq:ADR_tiploss}
\left\lbrace
\begin{array}{ccc}	
dF_{L} = \dfrac{1}{2} C_L \rho S' U_{rel}^2 F,
\\   
\\
dF_{D} = \dfrac{1}{2} C_D \rho S' U_{rel}^2 F.
\\
\end{array}\right.
\end{equation}	

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Actuator Line Method (ALM)}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%++++++++++++++++++++++++++++++++
\subsection{Overview}
%++++++++++++++++++++++++++++++++

The previous model, the ADR, can be seen as the average of the blade motion over one or several rotations. It gives the tendency of the wake, but it cannot represent its instantaneous particularities. To overcome this problem, it is possible to use lines to model the blades, instead of a disk: it is the \textit{Actuator Line Method} (ALM). The method has been generalized by \citet{sorensen2002numerical}. Each blade applies a force on the fluid, as shown in Figure \ref{fig:AL_principe}. In order to find the position of the blades and their velocity, it is necessary to take into account their kinematic motion. Then, the blade element theory allows to determine the aerodynamic forces to apply.

\begin{figure}[h]
\centering
\includegraphics[scale=1]{\EPSDIR/Wind_Turbine_fig/ALprincipe.pdf}
\caption{Overview of the Actuator Line Method \citet{joulin2019modelisation}.}  
\label{fig:AL_principe}
\end{figure}
\medbreak
The first coupling between the Actuator Line Method and a CFD code has been introduced by \citet{mikkelsen2003actuator}. It allows to reproduce the helical shape of the unsteady wake and capturing tip and root vortices (\citet{ivanell2007numerical}, \citet{ivanell2007numericalv}) giving a better description of the wake downstream the wind turbines (\citet{Ivanell2009}, \citet{Troldborg2009}).
\medbreak
For these reasons, the ALM has been introduced in several LES frameworks (\citet{porte2011large} or \citet{tabib2017near}). Interactions between wind turbines and atmospheric boundary layer have been studied (\citet{lu2011large}, \citet{lu2015impact}). It has also been coupled with WRF-LES (\citet{marjanovic2015simulation} and \citet{marjanovic2017implementation}) for wind farm studies, or in SOWFA, based on OpenFOAM  \citet{Churchfield2012}. The coupling with Meso-NH has been introduced by \citet{joulin2020theactuator}.


%++++++++++++++++++++++++++++++++
\subsection{Theory}
%++++++++++++++++++++++++++++++++
\subsubsection*{Hypotheses}
\label{ss:hypALM}
The model is based on a number of assumptions:
\begin{itemize}
\item Incompressible flow,
\item 2D flow along the airfoils,
\item No aerodynamic interaction between each blade element (which excludes any radial flow).
\end{itemize}
\subsubsection*{Wind turbine kinematics and frames}		
\label{ss:EOL_M_cinematiqueAL}

The wind turbine can be divided into different kinematic classes. As shown in Figure \ref{fig:ALrep}, each class has its own frame:
\begin{multicols}{2}
\begin{itemize}
\item the domain associated with $R_G$ frame,
\item the tower associated with $R_T$ frame,
\item the nacelle associated with $R_N$ frame,
\item the hub associated with $R_H$ frame,
\item the $i^{th}$ blade associated with $R_{B_i}$ frames,
\item the $j^{th}$ elements of the $i^{th}$ blade associated with $R_{E_{ij}}$ frames.
\end{itemize}
\end{multicols}
\medbreak
Even if there is no motion between the blade elements and their blade, the frames $R_{E_{ij}}$ linked to the sections have been introduced to make the aerodynamic calculations easier. The rotation matrices $\mathcal{M}_{R_\clubsuit \rightarrow R_\spadesuit}$ are determined at each time step to move from a frame to another one. The kinematic relations allow to know the translational and rotational velocities of each blade element. Details about these relations can be found in \citet{joulin2019modelisation}, \textit{Annexe C}.
\medbreak
\begin{figure}[h]
\hspace{-1.8cm}
\includegraphics[scale=0.6]{\EPSDIR/Wind_Turbine_fig/CinematiqueRep.pdf}
\caption{Illustration of the frames \citet{joulin2019modelisation}}  
\label{fig:ALrep}
\end{figure}

\subsubsection*{Applying blade element theory}
										

\paragraph*{Determination of $U_{rel}$ and $\alpha$:}
Thanks to the kinematic definition and to the rotation matrices, the determination of the relative wind $U_{rel}$ is almost direct. Indeed, the kinematic relations enable to know the velocity of translation $U^{ij}_{trans}$. Considering the $j^{th}$ elements of the $i^{th}$ blade located in a surrounding volume of air with a velocity $U^{ij}_{wind}$, the relative velocity writes:
\begin{equation}
\label{eq:AL_urel}
\fbox{$
\overrightarrow{U^{ij}_{rel}}_{\vert _{R_{E_{ij}}}} = \mathcal{M}_{R_{E_{ij}} \rightarrow R_{G_{ij}}} \times \overrightarrow{U^{ij}_{wind}}_{\vert _{R_{G_{ij}}}} - \overrightarrow{U^{ij}_{trans}}_{\vert _{R_{E_{ij}}}}
$}.
\end{equation}
And the angle of attack $\alpha$ can be evaluated thanks to:
\begin{equation}
\label{eq:AL_alpha}
\fbox{$
\alpha = tan^{-1} \left( \dfrac{\overrightarrow{U^{ij}_{rel}}_{\vert _{R_{E_{ij}}}} \cdot \overrightarrow{x}}{\overrightarrow{U^{ij}_{rel}}_{\vert _{R_{E_{ij}}}} \cdot \overrightarrow{y}} \right)
$}.
\end{equation}

\paragraph*{Aerodynamic forces:}
By knowing $U_{rel}$ and $\alpha$, the blade element theory can be applied. The aerodynamic forces can be expressed in the aerodynamic frame as:
\begin{equation}
\label{eq:eol_m_alm_eff}	
\fbox{$
\left\lbrace
\begin{array}{ccc}	
dF_{L} = \dfrac{1}{2} \rho S U_{rel}^2 C_L(\alpha),
\\   
\\
dF_{D} = \dfrac{1}{2} \rho S U_{rel}^2 C_D(\alpha).
\\
\end{array}\right.
$}
\end{equation}	

where the lift $C_L$ and drag $C_D$ coefficients are known according to the angle of attack $\alpha$ and the Reynolds number $Re$. The lifting surface $S$, evaluated with the airfoil chord $c$ and the radial width $dr$ ($S = c dr$). By applying a rotation angle $a$, the forces can be expressed in $R_{E_{ij}}$, and then in the global frame by using $\mathcal{M}_{R_{G_{ij}} \rightarrow R_{E_{ij}}}$.

%++++++++++++++++++++++++++++++++
\subsection{Numerical implementation}
%++++++++++++++++++++++++++++++++

The first step of the Actuator Line Method algorithm is to compute the kinematics of the wind turbine. An illustration of the kinematic classes and their discretization is shown in Figure \ref{fig:ALMdiscret}. The kinematic algorithm computes, at each time step, the new positions and velocities of all elements. 
Knowing the position of a blade element, the local wind speed can be extracted. To do so, the wind speed is computed at mass point. Then, it is possible to use the closest value (from the blade element) of the wind, or to interpolate it from the 8-neighborhood cells.
Afterwards, the relative velocity is computed using (\ref{eq:AL_urel}), and the angle of attack $\alpha$ with (\ref{eq:AL_alpha}). The aerodynamic coefficients $C_L$ and $C_D$ are then computed by knowing $\alpha$, from a spline-cubic interpolation of the tabulated input data. Finally, the aerodynamic forces are computed in the aerodynamic frame using (\ref{eq:eol_m_alm_eff}): 
\begin{equation}
\label{eq:eol_m_alm_eff_num}	
\fbox{$
\left\lbrace
\begin{array}{ccc}	
dF_{L} = \dfrac{1}{2} \rho c \Delta r U_{rel}^2 C_L(Re,\alpha),
\\   
\\
dF_{D} = \dfrac{1}{2} \rho c \Delta r U_{rel}^2 C_D(Re,\alpha).
\\
\end{array}\right.
$}
\end{equation}	
A last change of frame enables the projection of these forces to the global momentum budget of Meso-NH. One can note that, for the moment, only the effects of the blades are computed: the nacelle and the tower are neglected. 
\begin{figure}[h]
\centering
\includegraphics[scale=0.8]{\EPSDIR/Wind_Turbine_fig/ALdiscret.pdf}
\caption{Illustration of the discretised kinematic classes of the ALM. Each color is a different class, and each arrow indicates a possible motion. \citet{joulin2019modelisation}}
\label{fig:ALMdiscret}  
\end{figure}

Note: Special attention must be given to the number of radial (NNB\_BLAELT) elements depending on the mesh used in Meso-NH. To avoid gaps in the mesh and ensure a proper distribution of efforts, it is recommended to have:
\begin{equation}
NNB\_RADELT > \dfrac{2R}{\min(\Delta x, \Delta y, \Delta z)}
\end{equation}
where $R$ is the radius of the rotor, and $\min(\Delta x, \Delta y, \Delta z)$ is the smallest dimension of the Meso-NH mesh at the rotor level.


%++++++++++++++++++++++++++++++++
\subsection{Additional implementations}
%++++++++++++++++++++++++++++++++
\subsubsection*{1D linear smearing}
It is possible to use the 1D linear smearing mentionned in \ref{sss:1dsmearADNR}.

\subsubsection*{3D linear smearing}
It is possible to use the 3D linear smearing mentionned in \ref{sss:3dsmearADNR}.

\subsubsection*{Tip loss correction}
\label{sss:tiplossALM}

An over-estimation of loads is commonly predicted by the Actuator Line Method. It appears when the mollification (smearing) or the resolution are not adequate to generate de tip vortices and so the tip losses. 
To overcome this issue, the community usually applies the tip loss correction of \citet{glauert1935airplane}, explainded in \ref{sss:tiplossADR}. It allows a better prediction of the loads (\citet{mikkelsen2003actuator} or \citet{shen2005tip}).
\medbreak
One can note that in the ALM, the number of blade is finite and this correction should not be used. Some specific corrections could be implemented, as shown by \citet{breton2008study}. Besides, a better distribution of forces is also possible as proposed by \citet{churchfield2017advanced}. 
As Meso-NH is a meteorological tool, the resolution might be too large compared to the guidelines recommanded for the ALM \citet{jha2014guidelines}. Then, the tip loss correction is applied by default in Meso-NH (LTIPLOSSG = .TRUE.).

\subsubsection*{Time-splitting method}
\label{sss:time_splitting}
In order to save computational cost, a time-splitting method has been introduced \citet{joulin2020theactuator}. This method is also called Actuator Sector Method \citet{Storey2015}. If this technique allows for computational time savings, it should be used with caution, as the results may be degraded (see \citet{joulin2019modelisation, jezequel2022simulations}).
The Courant-Friedrichs-Lewy (CFL) criterion of Meso-NH imposes a time step $\Delta t_{MNH}$. The criterion writes:
\begin{equation}	
n_{CFL} =  c \dfrac{\Delta t_{MNH}}{min(\Delta x,\Delta y,\Delta z)},
\label{eq:MNH_CLF}
\end{equation}  
where $c$ is the flow velocity, and  $\Delta x$, $\Delta y$, $\Delta z$ the cell sizes. In Meso-NH, $n_{CFL} < 3$ is imposed according to the scheme used.
\medbreak
Nevertheless, the ALM often requires a smaller time step in order to ensure that a blade element point will not skip a mesh cell during this time step. The criterion for the Actuator Line Method time step $ \Delta t_{ALM}$ can thus be expressed as:
\begin{equation}
\Delta t_{ALM} \leqslant \dfrac{min(\Delta x,\Delta y,\Delta z)}{\Omega r_{tip}},
\label{eq:dt_alm}
\end{equation}
where $\Omega$ is the angular velocity of the wind turbine, and $r_{tip}$ the tip radius of the blade.
\medbreak
Because Meso-NH does not need such a small time step, a $\Delta t_{MNH}$ respecting the CFL criterion is preserved. On the other side, the ALM algorithm is called $N_{split}$ times over this duration in order to respect the ALM time step criterion (eq. (\ref{eq:dt_alm})) and to reduce by $N_{split} - 1$ the number of iterations from the LES solver.
\medbreak
\begin{figure}[h]
\centering
\includegraphics[scale=0.8]{\EPSDIR/Wind_Turbine_fig/Time_Splitting.pdf}
\caption{Illustration of time-splitting method, for $N_{split} = 3$. \citet{joulin2019modelisation}}
\label{fig:timesplit}  
\end{figure}
The method is illustrated in Figure \ref{fig:timesplit}. The red lines indicate blade positions at $t_{i}$ and $t_{i+1}$. The red dots indicate blade elements. The black crosses on the left Figure show the cells missing the blade passage. On the right, the time-splitting method enables to get the history of the blade motion (green lines and dots) to compute to aerodynamic forces.

One can note that during a Meso-NH time step, the wind field is frozen. In the end, for each blade element point, the applied force is the aerodynamic force evaluated by the ALM divided by $N_{split}$ to respect the momentum budget over $\Delta t_{MNH}$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%% BIBLIOGRAPHY %%%%%%%%%%%%%%%%%%%%%%%%
\begin{btSect}{3-10-WindTurbine}
\section{References}
\btPrintCited
\end{btSect}
%%%%%%%%%%%%%%%%%%%%%%%%%%%% BIBLIOGRAPHY %%%%%%%%%%%%%%%%%%%%%%%%
